{% extends "base.html" %}
{% block headstart %}
{% endblock %}
{% block headend %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.esm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/helpers.esm.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
{% endblock %}
{% block title %} {{ routeticker }} {% endblock %}
</head>
<!-- <body class="bg-dark"> -->
<body class="bg-dark">
{% block content %}
<div class="container-fluid main-container">
  <div class="row justify-content-center">
    <div class="col-md-10 content">
      <div class="row my-2">
        <div class="col-md-2 content">
          <a class="btn btn-primary" href="/">Weekly Screener</a>
        </div>
      </div>
            <div class="row my-4">
                <div class="col-md-4">
                    <div class="card">
                        <h5 class="card-header">{{ earningsdate }} {{ bmoamc }}</h5>
                        <div class="card-body">
                            <h5 class="card-title"> {{ routeticker }}<br/>
                            {{ companyname }}</h5>
                            <p class="card-text">{{ mw }}</p>
                        </div>
                      </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <h5 class="card-header">Implied Move</h5>
                        <div class="card-body">
                            <h5 class="card-title">&plusmn;{{ impmove }}%</h5>
                            <p class="card-text">{% if underover > 0 %}Undervalued: {{ underover|abs }}%
                                {% else %}Overvalued: {{ underover|abs }}% {% endif %}<br/> 
                                Relative to {{ countreports }} Qtr Avg</p>
                        </div>
                      </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <h5 class="card-header">Historic Move Averages</h5>
                        <div class="card-body">
                          <h5 class="card-title">&plusmn;{{ absactualmoveperc }}% of {{ countreports }} Reports</h5>
                          <p class="card-text">&plusmn;{{ cap12 }}% of {{ cr12 }} Reports</br>
                          &plusmn;{{ cap4 }}% of {{ cr4 }} Reports</p>
                        </div>
                      </div>
                </div>
            </div>
            <div class="row my-4">
                <div class="col-md-4">
                    <div class="card">
                        <h5 class="card-header">Profile</h5>
                        <div class="card-body">
                          <h5 class="card-title">{{ industry }}</h5>
                          <!-- <p class="card-text">{{ city }}, {{ state }} {{ zipcode }}<br/> -->
                          <p class="card-text"><a href="{{ website|safe }}">{{ website }}</a><br/>

                            <a href="{{ reportlink|safe }}">Report Filed: {{ filedate }}</a></p>
                        </div>
                      </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <h5 class="card-header">Volumes for {{ routeticker }}</h5>
                        <div class="card-body">
                          <h5 class="card-title">Avg Opt Vol: {{ avg_optvol }}</h5>
                          <p class="card-text">Avg Vol: {{ avg_stockvol }}<br/>
                                Market Cap: {{ market_cap }} Billion</p>
                        </div>
                      </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                      <h5 class="card-header">Predicted Ranges for {{ routeticker }}</h5>
                      <div class="card-body">
                        <p class="card-text">ImpMove: ${{ implieddown }} / ${{ impliedup }}<br/>
                             HistMove: ${{ histdown }} / ${{ histup }}<br/>
                              Breakseven: ${{ bedown }} / ${{ beup }}</p>
                      </div>
                    </div>
              </div>
              </div> <!-- This is the closing div for the second row of cards -->
              <div class="row my-4">
                <div class="col-md-4">
                  <div class="card">
                      <h5 class="card-header">Implied Volatility for {{ routeticker }}</h5>
                      <div class="card-body">
                        <h5 class="card-title">Current IV: {{ iv }}</h5>
                        <p class="card-text">IV Crush to: {{ ivcrushto }}</p>
                      </div>
                    </div>
                </div>
              </div>
                <div class="row my-6">
                  <div class="col-md-6">
                    <div class="card" style="height: 100%">
                        <h5 class="card-header">Historic Moves for {{ routeticker }}</h5>
                        <div class="card-body">
                            <p class="card-text">
                                <canvas id="myChart"></canvas>
                            </p>
                        </div>
                      </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card" style="height: 100%">
                      {% set tvlink = 'https://www.tradingview.com/symbols/' + routeticker + '/' %}
                      {% set tvsymbol = routeticker %}
                        <div class="card-header tradingview-widget-copyright"><a href={{ tvlink }} rel="noopener" target="_blank">
                        <span class="blue-text">{{routeticker}} Chart</span></a> by TradingView</div>

                        <div class="card-body">
                                <!-- TradingView Widget BEGIN -->
                                <div class="tradingview-widget-container">
                                    <div id="tradingview_9f216"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>   
      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
      <script type="text/javascript">
      new TradingView.widget(
      {
      "autosize": true,
      "symbol": "{{ tvsymbol }}",
      "interval": "1",
      "timezone": "America/New_york",
      "theme": "dark",
      "style": "1",
      "locale": "en",
      "hide_top_toolbar": true,
      "hide_bottom_toolbar": true,
      "toolbar_bg": "#f1f3f6",
      "enable_publishing": false,
      "allow_symbol_change": false,
      "container_id": "tradingview_9f216"
    }
      );
      </script>
    </div>
<!-- TradingView Widget END -->
        <div>
            <span class="col-md-3" style="color: white"><a href="{{ oslink|safe }}">{{ oslink }}</a></span>
        </div>
</div>
</div>
{% endblock %}
{% block footerscript %} 
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script>
        const labels = {{ edatelst|tojson }};   
        const data = {
          labels: labels,
          datasets: [{
            label: 'Post Release Move %',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: {{ mvlst|tojson }},
          }, {
            label: 'Current Implied Move %',
            borderColor: 'rgb(54,162,235)',
            data: [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10],
            type: 'line',
        }]
        };
        const config = {
          type: 'bar',
          data: data,
          options: {}
        };
      </script>
 <script>
    const myChart = new Chart(
      document.getElementById('myChart'),
      config
    );
  </script>      
{% endblock %}